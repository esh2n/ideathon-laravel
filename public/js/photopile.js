var photopile=function(){function i(){$("ul.photopile").children().each(function(){c.init($(this))}),l.init(),$(window).on("load",function(){$(".js div.photopile-wrapper").css({padding:e+"px","background-image":"none"}).children().css({opacity:"0",display:"inline-block"}).fadeTo(n,1),a.init(),o&&t()})}function t(){var i=$("ul.photopile").children().first();window.setInterval(function(){i.children().first().click(),i=i.hasClass("last")?$("ul.photopile").children().first():i.next()},s)}var e=13,n=200,o=!1,s=5e3,c={active:"photopile-active-thumbnail",init:function(i){self=this,i.children().css("padding","2px"),self.bindUIActions(i),self.setRotation(i),self.setOverlap(i),self.setRandomZ(i);var t=0,e=0;i.draggable({start:function(t,e){i.addClass("preventClick"),i.css("z-index",7),$("ul.photopile").children().each(function(){i.unbind("mouseover",self.bringToTop),i.unbind("mouseout",self.moveDownOne)})},drag:function(n,o){e=1.2*(o.offset.left-t),ratio=parseInt(100*e/360),i.css("transform","rotateZ("+ratio+"deg)"),t=o.offset.left},stop:function(t,e){i.css("z-index",6),$("ul.photopile").children().each(function(){i.bind("mouseover",self.bringToTop),i.bind("mouseout",self.moveDownOne)})}}),i.css("background","white")},bindUIActions:function(i){var t=this;i.bind("mouseover",t.bringToTop),i.bind("mouseout",t.moveDownOne),i.click(function(i){if(i.preventDefault(),$(this).hasClass("preventClick"))$(this).removeClass("preventClick");else{if($(this).hasClass(t.active))return;l.pickup($(this))}}),i.mousedown(function(i){$(this).removeClass("preventClick")})},bringToTop:function(){$(this).css({"z-index":6,background:"#EAEAEA"})},moveDownOne:function(){$(this).css({"z-index":5,background:"white"})},setOverlap:function(i){i.css("margin",-1*e/2+"px")},setZ:function(i,t){i.css("z-index",t)},setRandomZ:function(i){i.css({"z-index":Math.floor(5*Math.random()+1)})},setRotation:function(i){var t=Math.floor(91*Math.random())+-45;i.css({transform:"rotate("+t+"deg)"})},setActive:function(i){i.addClass(this.active)},getActiveOffset:function(){return $("li."+this.active).offset()},getActiveHeight:function(){return $("li."+this.active).height()},getActiveWidth:function(){return $("li."+this.active).width()},getActiveImgSrc:function(){return $("li."+this.active).children().first().attr("href")},getActiveRotation:function(){var i=$("li."+this.active).css("transform"),t=i.split("(")[1].split(")")[0].split(",");return Math.round(Math.asin(t[1])*(180/Math.PI))},getActive:function(){return!!$("li."+this.active)[0]&&$("li."+this.active).first()},getActiveShift:function(){return this.getActiveRotation()<0?-.4*this.getActiveRotation(c):.4*this.getActiveRotation(c)}},l={container:$('<div id="photopile-active-image-container"/>'),image:$('<img id="photopile-active-image" />'),info:$('<div id="photopile-active-image-info"/>'),isPickedUp:!1,fullSizeWidth:null,fullSizeHeight:null,windowPadding:40,init:function(){$("body").append(this.container),this.container.css({}),this.container.append(this.image),this.image.css("display","block"),this.container.append(this.info),this.info.append("<p></p>"),this.info.css("opacity","0")},pickup:function(i){var t=this;t.isPickedUp?t.putDown(function(){t.pickup(i)}):(t.isPickedUp=!0,c.clearActiveClass(),c.setActive(i),t.loadImage(c.getActiveImgSrc(),function(){t.image.fadeTo(n,"1"),t.enlarge(),$("body").bind("click",function(){t.putDown()})}))},putDown:function(i){self=this,$("body").unbind(),self.hideInfo(),a.hideControls(),c.setZ(c.getActive(),5),self.container.stop().animate({top:c.getActiveOffset().top+c.getActiveShift(),left:c.getActiveOffset().left+c.getActiveShift(),width:c.getActiveWidth()+"px",height:c.getActiveHeight()+"px",padding:"2px"},500,function(){self.isPickedUp=!1,c.clearActiveClass()})},loadImage:function(i,t){var e=this;e.image.css("opacity","0"),e.startPosition();var n=new Image;n.src=i,n.onload=function(){e.fullSizeWidth=this.width,e.fullSizeHeight=this.height,e.setImageSource(i),t&&t()}},startPosition:function(){this.container.css({top:c.getActiveOffset().top+c.getActiveShift(),left:c.getActiveOffset().left+c.getActiveShift(),transform:"rotate("+c.getActiveRotation()+"deg)",width:c.getActiveWidth()+"px",height:c.getActiveHeight()+"px",padding:2}).fadeTo(n,"1"),c.getActive().fadeTo(n,"0")},enlarge:function(){var i=window.innerHeight?window.innerHeight:$(window).height(),t=$(window).width()-2*this.windowPadding,e=i-2*this.windowPadding;t<this.fullSizeWidth&&e<this.fullSizeHeight?t*(this.fullSizeHeight/this.fullSizeWidth)>e?this.enlargeToWindowHeight(e):this.enlargeToWindowWidth(t):t<this.fullSizeWidth?this.enlargeToWindowWidth(t):e<this.fullSizeHeight?this.enlargeToWindowHeight(e):this.enlargeToFullSize()},showInfo:function(){this.info.children().text(c.getActive().children("a").children("img").attr("alt")),this.info.css({"margin-top":-this.info.height()+"px"}).fadeTo(n,1)},hideInfo:function(){this.info.fadeTo(n,0)},enlargeToFullSize:function(){self=this,self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-self.fullSizeHeight/2,left:$(window).scrollLeft()+$(window).width()/2-self.fullSizeWidth/2,width:self.fullSizeWidth-20+"px",height:self.fullSizeHeight-20+"px",padding:"10px"},function(){self.showInfo(),a.showControls()})},enlargeToWindowWidth:function(i){self=this;var t=i*(self.fullSizeHeight/self.fullSizeWidth);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-t/2,left:$(window).scrollLeft()+$(window).width()/2-i/2,width:i+"px",height:t+"px",padding:"10px"},function(){self.showInfo(),a.showControls()})},enlargeToWindowHeight:function(i){self=this;var t=i*(self.fullSizeWidth/self.fullSizeHeight);self.container.css("transform","rotate(0deg)").animate({top:$(window).scrollTop()+$(window).height()/2-i/2,left:$(window).scrollLeft()+$(window).width()/2-t/2,width:t+"px",height:i+"px",padding:"10px"},function(){self.showInfo(),a.showControls()})},setImageSource:function(i){this.image.attr("src",i).css({width:"100%",height:"100%","margin-top":"0"})}},a={next:$('<div id="photopile-nav-next" />'),prev:$('<div id="photopile-nav-prev" />'),init:function(){l.container.append(this.next),l.container.append(this.prev),$("ul.photopile li:first").addClass("first"),$("ul.photopile li:last").addClass("last"),this.bindUIActions()},bindUIActions:function(){this.next.click(function(i){i.preventDefault(),a.pickupNext()}),this.prev.click(function(i){i.preventDefault(),a.pickupPrev()}),$(document.documentElement).keyup(function(i){39==i.keyCode&&a.pickupNext(),37==i.keyCode&&a.pickupPrev()})},pickupNext:function(){var i=c.getActive();i&&(i.hasClass("last")?l.pickup($("ul.photopile").children().first()):l.pickup(i.next("li")))},pickupPrev:function(){var i=c.getActive();i&&(i.hasClass("first")?l.pickup($("ul.photopile").children().last()):l.pickup(i.prev("li")))},hideControls:function(){this.next.css("opacity","0"),this.prev.css("opacity","0")},showControls:function(){this.next.css("opacity","100"),this.prev.css("opacity","100")}};return{scatter:i,autoplay:t}}();photopile.scatter();
